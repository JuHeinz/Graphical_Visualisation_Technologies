<!DOCTYPE html>
<html lang="de" data-bs-theme="dark">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width">
        <title>EA 9 | Graphical Visualisation Technologies</title>

        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
            integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">

        <link rel="stylesheet" href="../styles.css">
        <link rel="stylesheet" href="./ea9.css">
        <script src="../ext/gl-matrix.js"></script>
        <script src="../textured-models/vetexData_plane_textured.js"></script>
        <script src="../textured-models/vertexData_torus_textured.js"></script>
        <script src="../textured-models/vertexData_sphere_textured.js"></script>

        <script src="./ea9.js"></script>

        <!--VERTEX SHADER-->
        <script type="x-shader/x-vertex" id="vertexshader">
       attribute vec3 aPosition;
			attribute vec3 aNormal;
			attribute vec2 aTextureCoord;
			
			uniform mat4 uPMatrix;
			uniform mat4 uMVMatrix;
			uniform mat3 uNMatrix;

            varying vec3 vNormal;
			varying vec4 vPosition;
			
			varying vec2 vTextureCoord;
			
			void main(){
				//Vertex Positionen zu Eye-Koordinaten mit der ModelView Matrix transformieren.
				vec4 tPosition = uMVMatrix * vec4(aPosition, 1.0);
				// gl_Position anhand der Projection-Matrix und und den eye-Koordinaten berechnen.
				gl_Position = uPMatrix * tPosition;
			
                // Bestimmen der korrekt gedrehte Normale tNormal aus aNormal mittels der Normal-Matrix uNMatrix.
                // So stimmen die Normals auch, wenn man das Modell dreht.
				vec3 tNormal = normalize(uNMatrix * aNormal);
				vPosition = tPosition;
				vNormal = tNormal;	

				vTextureCoord = aTextureCoord;		
        }
		</script>

        <!--FRAGMENT SHADER-->
        <script type="x-shader/x-fragment" id="fragmentshader">
			precision mediump float;
			
			uniform sampler2D uTexture;
			
			varying vec2 vTextureCoord;
            varying vec3 vNormal;
			varying vec4 vPosition;
			

            // Material.
			struct PhongMaterial {
				vec3 ka;
				vec3 kd;
				vec3 ks;
				float ke; 
			};
			uniform PhongMaterial material;
			
			// Ambient light.
			uniform vec3 ambientLight;
			
			// Pointlights.
			const int MAX_LIGHT_SOURCES = 8;
			struct LightSource {
				bool isOn;
				vec3 position;
				vec3 color;
			};
			uniform LightSource light[MAX_LIGHT_SOURCES];
			
			// Phong illumination for single light source,
			// no ambient light.
			vec3 phong(vec3 p, vec3 n, vec3 v, LightSource l) {
			
				vec3 L = l.color;
			
				vec3 s = normalize(l.position - p);
				vec3 r = reflect(-s, n);
				
				float sn = max( dot(s,n), 0.0);
				float rv = max( dot(r,v), 0.0);
							
				vec3 diffuse = material.kd * L * sn;								
				vec3 specular = material.ks * L * pow(rv, material.ke);
			
				return diffuse + specular;			
			}
			
			// Phong illumination for multiple light sources
			vec3 phong(vec3 p, vec3 n, vec3 v) {
			
				// Calculate ambient light.
				vec3 result = material.ka * ambientLight;
				
				// Add light from all light sources.
				for(int j=0; j < MAX_LIGHT_SOURCES; j++){
					if(light[j].isOn){
						result += phong(p, n, v, light[j]);
					}
				}
				return result;
			}
			

			void main() {
                //Bestimmung view Vektor 
                vec3 v = normalize(-vPosition.xyz); //Eye-Koordinaten normalisieren und vierte Dimension fallen lassen. 
                vec3 vNormal = normalize(vNormal);
			    vec4 tColor = texture2D(uTexture, vTextureCoord);
			    vec4 lighting = vec4( phong(vPosition.xyz, vNormal, v), 1.0);
			    gl_FragColor = tColor * lighting;
			}			
		</script>

    </head>

    <body onload="app.start()">

        <header>
            <nav class="navbar navbar-expand-lg bg-body-tertiary" id="global-nav">
                <div class="container-fluid">
                    <a class="navbar-brand" href="#">Graphical Visualisation Technologies</a>

                    <div class="navbar-nav">
                        <a class="nav-link " href="../index.html">Aufgabenübersicht</a>
                    </div>

                </div>
            </nav>

            <div class="title-section">
                <h1 class="display-5">Einsendeaufgabe 9</h1>
                <p class="lead">
                    Torustextur
                </p>
            </div>

        </header>

        <main>
            <canvas id="canvas"></canvas>

            <div class="controls">
                <div>
                    <h2 class="h3 fw-light">Licht Interaktion</h2>
                    <ul class="list-group-flush">
                        <li class="list-group-item">
                            <span class="badge text-bg-dark"><code>l,L</code></span>
                            Lichter bewegen
                        </li>
                    </ul>

                    <h2 class="h3 fw-light">Kamera Interaktion</h2>

                    <ul class="list-group-flush">

                        <li class="list-group-item">
                            <span class="badge text-bg-dark"><code>W,S</code></span>
                            auf Y-Ebene bewegen
                        </li>
                        <li class="list-group-item">
                            <span class="badge text-bg-dark"><code>A,D</code></span>
                            auf X-Ebene bewegen
                        </li>
                        <li class="list-group-item"> <span class="badge text-bg-dark"><code>Pfeiltasten</code></span>
                            Kamera kreisen </li>
                        <li class="list-group-item">
                            <span class="badge text-bg-dark"><code>(Shift) + n</code></span> Kamera Distanz ändern
                        </li>
                        <li class="list-group-item"><span class="badge text-bg-dark">
                                <code>p</code> , <code>o</code> , <code>f</code></span> Projektion
                            umschalten. </li>
                        <li class="list-group-item"> <span class="badge text-bg-dark"><code>r</code></span> Reset</li>
                    </ul>

                </div>

                <div>
                    <h2 class="h3 fw-light">Benutzerhinweis</h2>

                    <p>Nach Ändern der ViewPort-Größe (z.B. durch Öffnen der Dev-Tools oder Resizing des Fensters)
                        muss die Seite neu geladen werden, damit die Canvas scharf erscheint.</p>
                </div>
                <div>
                    <h2 class="h3 fw-light">Dokumentation</h2>
                    <p>Die Donut-Textur und den Hintergrund habe ich selbt gezeichnet.</p>
                    </p>
                </div>
            </div>

        </main>

        <footer>
            <p class="text-body-secondary">Julia Heinzelmann</p>
            <p class="text-body-secondary">Berliner Hochschule für Technik </p>
            <p class="text-body-secondary"> <a
                    href="https://github.com/JuHeinz/Graphical_Visualisation_Technologies">Gitub Repository</a></p>
        </footer>

    </body>

</html>